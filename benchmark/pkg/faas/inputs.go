package faas

import (
	"encoding/base64"
	"encoding/binary"
	"fmt"
	"strings"
)

// Argument expected by the KaaS executor
type KaasArg struct {
	// kernel chain name
	Name string `json:"name"`

	// base64 encoded binary inputs
	Inputs string `json:"inputs"`

	// block and grid sizes are the CUDA dimensions to use for funcNames
	BlockSizes []int `json:"block_sizes"`
	GridSizes  []int `json:"grid_sizes"`

	// list of kernels to call from the kernel chain's shared library
	FuncNames []string `json:"func_names"`

	// Sizes for the temporary and output buffers on the GPU
	OutputSize int `json:"output_size"`
	TmpSize    int `json:"tmp_size"`
}

// Argument expected by the radix sort function in SRK
type FaasArg struct {
	// Should be either 'provided' or 'generate'
	RequestType string `json:"requestType"`
	// base64 encoded binary data representing list of uint32s to sort (can be
	// blank if requestType is 'generated')
	Data string `json:"data"`
}

func NewFaasArg(requestType string, intData []uint32) (*FaasArg, error) {
	nChar := base64.StdEncoding.EncodedLen(len(intData) * 4)
	var encData strings.Builder
	encData.Grow(nChar)
	encoder := base64.NewEncoder(base64.StdEncoding, &encData)
	err := binary.Write(encoder, binary.LittleEndian, intData)
	if err != nil {
		return nil, err
	}
	encoder.Close()

	return &FaasArg{requestType, encData.String()}, nil
}

func DecodeFaasResp(encoded string) ([]uint32, error) {
	// Convert the contents from base64 encoded to bytes[]
	bytes, err := base64.StdEncoding.DecodeString(encoded)
	if err != nil {
		return nil, fmt.Errorf("Failed to decode response: %v", err)
	}

	numElem := len(bytes) / 4
	ints := make([]uint32, numElem)
	for i := 0; i < numElem; i++ {
		ints[i] = binary.LittleEndian.Uint32(bytes[(i * 4):(i*4 + 4)])
	}

	return ints, nil
}

// Example input to the kaas sorter. This represents 1024 uint32s to be sorted (they were generated randomly)
var exampleKaasArg = KaasArg{
	Name:       "radixsort",
	Inputs:     "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",
	BlockSizes: []int{1},
	GridSizes:  []int{1},
	FuncNames:  []string{"kaasInvoke"},
	OutputSize: 4096,
	TmpSize:    0,
}

// Example input to the FaaS sort handler. Otherwise it's identical to the KaaS call.
var exampleFaasArg = FaasArg{
	RequestType: "provided",
	Data:        "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",
}

// Known-good sorted output of the encoded inputs in the two examples above
var exampleGoldenOutput = []uint32{
	5516155, 6322958, 9258351, 12749675, 15540823, 18577180, 30070096, 33953032,
	35900382, 40123509, 48234759, 50309915, 58746605, 60004810, 68022245, 69697925,
	77113613, 77674920, 88534986, 89327011, 93348601, 105101452, 110306504,
	110719057, 116422877, 127069363, 129051052, 137524105, 142796442, 149614451,
	158317023, 158929053, 163070974, 184383848, 185057087, 194455975, 210254311,
	215905200, 217674270, 226210048, 228005688, 229120632, 232240568, 239168283,
	243155749, 247406838, 252928758, 255930730, 257090932, 273564330, 273953695,
	275849769, 282650226, 282990431, 288913852, 289278018, 290507620, 292575710,
	292741510, 295068718, 302399526, 309216707, 311040341, 316946538, 321860846,
	325949995, 327748045, 328574957, 329023775, 330692690, 334106750, 338951724,
	345152270, 345587530, 347484398, 361343533, 364862665, 364876261, 373387789,
	380335064, 382539473, 391129316, 394238212, 398953331, 399670502, 403639238,
	408682871, 414684501, 415909967, 419859920, 422743520, 426904045, 428600437,
	436901461, 438779886, 442535617, 450470725, 469294173, 475723743, 477448768,
	479517195, 481793081, 487884097, 489104930, 491478204, 492545941, 497855129,
	502392342, 510352050, 514698294, 521284832, 521503385, 524934722, 528370579,
	546709752, 548466570, 548576970, 552531433, 557679219, 566892399, 568973574,
	570502420, 572389354, 575662482, 579842044, 584036685, 584383512, 586496271,
	589698083, 591869710, 595109818, 615439656, 618561259, 621455762, 622284495,
	625132358, 625391966, 628244469, 632572984, 635106560, 651010915, 655902271,
	656991474, 660516236, 661203764, 670181340, 671756847, 682027305, 682321795,
	690784350, 695399944, 697796102, 710595920, 719487056, 720504172, 724398733,
	752983192, 760580184, 764680049, 768809776, 775826045, 781335513, 785033438,
	790583657, 795875948, 802393669, 807401896, 810403256, 814448274, 819000407,
	826892534, 835412078, 838966447, 841093587, 842039960, 849171153, 856682525,
	856851668, 864722255, 866378823, 872393858, 885496571, 886992738, 887965893,
	889344740, 890588176, 894115076, 907506550, 909608409, 916044953, 920647125,
	921885710, 923627182, 924111709, 931282320, 931968891, 935463101, 940295907,
	946132900, 946870096, 952813772, 953124289, 958847254, 960467480, 968074911,
	972262684, 973295245, 984464720, 985267885, 995381566, 1004490878, 1012761821,
	1014369844, 1015613753, 1021120990, 1030151987, 1033469345, 1035794320,
	1036002333, 1039459414, 1047962796, 1051414081, 1052010538, 1053596129,
	1056409562, 1067066595, 1068523531, 1076298532, 1077933442, 1078560708,
	1080926202, 1088554220, 1095683993, 1099270409, 1105560583, 1116538972,
	1116912594, 1119512609, 1123311803, 1145318491, 1147258017, 1159884475,
	1172988488, 1179811076, 1185597850, 1185741500, 1189853793, 1198298268,
	1200607687, 1202287470, 1214261576, 1215976372, 1216015689, 1220756150,
	1222597209, 1225699807, 1227558994, 1233489701, 1237345080, 1242821467,
	1243998533, 1244100270, 1247534560, 1247913694, 1249002380, 1250411434,
	1256335228, 1259328679, 1260723205, 1263526096, 1263817991, 1266661309,
	1266715499, 1269738155, 1270490887, 1273199707, 1274591085, 1275603098,
	1278686627, 1286784768, 1293210634, 1295015768, 1304927761, 1310265251,
	1314395138, 1316625984, 1318560633, 1319908350, 1320078316, 1323169290,
	1323864413, 1326414928, 1334677720, 1334787091, 1345092570, 1347806276,
	1348376795, 1348650246, 1352259860, 1355061965, 1362146504, 1365884736,
	1367020507, 1367913888, 1370880164, 1370952192, 1377378364, 1380211850,
	1382102608, 1391221842, 1392077764, 1403613909, 1415732578, 1420301028,
	1432916358, 1437964410, 1443594010, 1446701350, 1451400756, 1451480438,
	1455423487, 1460462642, 1471778067, 1472340480, 1472659103, 1474085495,
	1479938757, 1484580474, 1492618660, 1498925936, 1503451020, 1515791796,
	1516618496, 1519951312, 1520167873, 1523157104, 1526624231, 1529392695,
	1533821058, 1534254716, 1534581385, 1538229804, 1540015190, 1547091588,
	1548475387, 1558374580, 1561293044, 1564299032, 1565334949, 1569151728,
	1574452499, 1585072005, 1586555757, 1592879627, 1593224841, 1601125245,
	1603350605, 1606007022, 1610894263, 1611697646, 1612582173, 1620986010,
	1621145254, 1622043188, 1622680192, 1630697284, 1631316445, 1640125420,
	1641045302, 1645455180, 1645809913, 1646095500, 1650597844, 1651477691,
	1654886682, 1658436700, 1663256699, 1666126120, 1666361758, 1667634640,
	1669336347, 1672141437, 1682210432, 1682507583, 1684036986, 1688201837,
	1694797095, 1699596309, 1701232983, 1721207298, 1722146901, 1724609777,
	1725185310, 1728114057, 1730902498, 1731112320, 1733880555, 1737817590,
	1738531429, 1738785351, 1742091135, 1744287687, 1746395643, 1750040344,
	1752418893, 1758035589, 1769809535, 1777090159, 1787522520, 1789000587,
	1791338225, 1792288402, 1795903458, 1799566481, 1800783428, 1800808354,
	1800824257, 1815375155, 1819942214, 1824496744, 1825273812, 1827214638,
	1832834130, 1834745764, 1838304172, 1839650987, 1840310480, 1840942382,
	1851525706, 1853270820, 1862759122, 1866869585, 1872195476, 1874674755,
	1875691697, 1876714435, 1878736175, 1890972144, 1891466018, 1892698053,
	1892939841, 1895514369, 1896525871, 1897828570, 1898735070, 1904878018,
	1921440860, 1923602709, 1924579898, 1928029904, 1935063214, 1935840993,
	1937489614, 1943168422, 1952680120, 1954247777, 1955300074, 1955548244,
	1962527618, 1965573714, 1983698546, 1987397312, 1990705410, 1991683378,
	1992112502, 1993324550, 1999964261, 2003269795, 2003691537, 2004994682,
	2009335214, 2010287228, 2017631634, 2019534070, 2021816449, 2022728373,
	2028193910, 2030021443, 2037327377, 2047302825, 2047387706, 2048511119,
	2057543245, 2057636641, 2059880420, 2062146257, 2066581751, 2070607510,
	2072982358, 2074207440, 2083765381, 2091448798, 2092020396, 2109241814,
	2113356281, 2117934717, 2118647741, 2120268178, 2133487871, 2134561190,
	2134561905, 2136945577, 2139025157, 2146078193, 2149490596, 2150515827,
	2156223744, 2156974738, 2157929468, 2164396765, 2168708112, 2169534674,
	2180044907, 2180657162, 2192065272, 2194712222, 2195980049, 2205004676,
	2205624213, 2208982241, 2224123767, 2225882143, 2226208829, 2229179119,
	2237632766, 2248320599, 2252910307, 2254750083, 2260652306, 2265795940,
	2266423046, 2268245111, 2278294696, 2292663722, 2296571521, 2298314532,
	2299113420, 2300566182, 2306124366, 2306402539, 2313990761, 2318490345,
	2320128635, 2320410045, 2323690045, 2325204552, 2326079107, 2329191361,
	2338602532, 2355145686, 2355953354, 2358409109, 2358564051, 2359531871,
	2360431661, 2365803267, 2371108396, 2371957543, 2376820890, 2384945386,
	2385920791, 2392692127, 2394535865, 2395566430, 2396118328, 2397227144,
	2397696232, 2407858036, 2411792076, 2415217724, 2418161336, 2418747579,
	2421375340, 2425146327, 2426530908, 2430431876, 2433726852, 2436615244,
	2438874587, 2441104384, 2443739007, 2445663911, 2457331249, 2464271814,
	2465098059, 2474270160, 2481382334, 2494342758, 2497426524, 2499630388,
	2501402838, 2503446049, 2508589041, 2512112509, 2520074719, 2532476762,
	2532978835, 2539478726, 2550321196, 2552394486, 2554948500, 2556637142,
	2559519819, 2562803763, 2568719033, 2588860276, 2591067562, 2592737882,
	2593834054, 2596780093, 2602280763, 2606574581, 2606967462, 2608612212,
	2620967135, 2622967701, 2626811925, 2631820181, 2633514988, 2635845035,
	2635922422, 2639075333, 2640679871, 2651834948, 2653513045, 2654914377,
	2657193221, 2659075129, 2664977829, 2674112804, 2681564721, 2688199761,
	2692901320, 2693361561, 2698817151, 2699608888, 2702340325, 2712156636,
	2718724320, 2723777055, 2723902549, 2726423811, 2729549375, 2737112271,
	2739151555, 2744252954, 2744899662, 2746242118, 2746300387, 2749892184,
	2751050669, 2752013652, 2753683025, 2756747934, 2757145337, 2757561624,
	2758931928, 2769129492, 2771119052, 2772789864, 2776766682, 2779701822,
	2782324111, 2784501525, 2794790757, 2802622032, 2806012333, 2808960655,
	2809649829, 2809880451, 2813435851, 2819255350, 2820271244, 2830367879,
	2836607355, 2837769197, 2841490014, 2849431527, 2850637573, 2855845869,
	2856413175, 2857185022, 2867768440, 2870284185, 2872388033, 2874390239,
	2880195051, 2880483264, 2882579391, 2890875296, 2893526648, 2898057263,
	2899002382, 2904302890, 2912199243, 2912336852, 2913419375, 2918227442,
	2928072780, 2930659909, 2939070092, 2942200138, 2945650318, 2946405974,
	2948858186, 2950945520, 2956858398, 2964453797, 2965978266, 2967606501,
	2972811187, 2975002082, 2983847557, 2993397684, 2995262466, 2999773991,
	3003273523, 3011406915, 3016522662, 3019182766, 3022581561, 3024769381,
	3030067132, 3038842556, 3039877639, 3042608928, 3050389299, 3052446956,
	3052838260, 3055559253, 3055709714, 3056148125, 3061173922, 3062191715,
	3068552260, 3071914579, 3078871431, 3080618972, 3080984348, 3086719992,
	3093383844, 3098146448, 3098664876, 3105016258, 3105379124, 3105981541,
	3106542679, 3109095287, 3119644849, 3131372666, 3131673717, 3137822487,
	3138412310, 3142567473, 3149095603, 3151708677, 3155371666, 3165073425,
	3165174883, 3167552644, 3170745921, 3175143545, 3179270185, 3183264824,
	3183424434, 3188218527, 3189082018, 3192446484, 3195152905, 3195182910,
	3197447025, 3197758950, 3198905190, 3203906309, 3205052859, 3208241824,
	3211201787, 3218739306, 3223290675, 3230062829, 3231022324, 3233471133,
	3242419593, 3244042826, 3244443772, 3247028601, 3255182635, 3255229898,
	3262509186, 3270050264, 3270652420, 3273787458, 3284395388, 3304916296,
	3308383644, 3309368013, 3311390156, 3313102087, 3316241453, 3317747839,
	3318680590, 3319467799, 3320336228, 3321189363, 3322555966, 3330058947,
	3333118043, 3338175949, 3340426803, 3341140228, 3350858232, 3354462672,
	3358672901, 3364178708, 3371001881, 3371151223, 3373357409, 3381244527,
	3385653631, 3387637870, 3389203834, 3396099919, 3397905984, 3405921557,
	3413971881, 3414564782, 3416348906, 3418337221, 3418942233, 3419772106,
	3423823260, 3427102834, 3429106310, 3430102219, 3444866857, 3455367486,
	3461218238, 3461535547, 3463368660, 3465300706, 3465524931, 3473150863,
	3481750886, 3486970227, 3493234443, 3493532171, 3498924821, 3502271327,
	3503510954, 3508687882, 3510405377, 3511338250, 3516141032, 3520166824,
	3532109076, 3532785133, 3533755156, 3536150708, 3539140054, 3542325644,
	3553042181, 3558305536, 3558456948, 3566712642, 3582830981, 3584289570,
	3588207126, 3590193335, 3595639454, 3595742814, 3602362182, 3608875467,
	3611203348, 3613819315, 3613874836, 3618454406, 3621788664, 3622928656,
	3628558615, 3633827224, 3637405701, 3650188097, 3651806354, 3663392634,
	3678185748, 3681793951, 3683132500, 3685970603, 3687560950, 3693319103,
	3694613001, 3697504314, 3699003408, 3701060196, 3701481515, 3703860884,
	3712832843, 3724794501, 3726938739, 3743511518, 3743736531, 3743812938,
	3750745721, 3752377546, 3762419679, 3763993997, 3766059132, 3767337988,
	3792648957, 3802303784, 3805861101, 3813284172, 3819668567, 3821622409,
	3829109202, 3833098010, 3837908522, 3838694975, 3843412535, 3847198161,
	3850314393, 3852586308, 3855000225, 3866842997, 3873642676, 3877342446,
	3889926105, 3892517618, 3896999797, 3899070302, 3899989068, 3900230385,
	3901382410, 3904329230, 3905864867, 3911957185, 3932018154, 3936177334,
	3939488349, 3954861952, 3955999646, 3957205646, 3959083070, 3960300432,
	3963286829, 3968119937, 3968139714, 3968546488, 3974897821, 3982482597,
	3996358738, 4001055796, 4005471744, 4011659598, 4013255682, 4018563103,
	4020545773, 4022255776, 4023870483, 4024486461, 4027764718, 4030338874,
	4043897068, 4047075661, 4057927159, 4064474028, 4078874779, 4084406278,
	4085814872, 4088141692, 4097498676, 4098978353, 4101018177, 4108872614,
	4109830443, 4112398870, 4115972008, 4122819860, 4124804452, 4130563593,
	4133076919, 4135639281, 4137856817, 4138415736, 4146678883, 4147907825,
	4148226199, 4153933516, 4155366714, 4162214584, 4176195237, 4177356750,
	4184447992, 4188793603, 4188930870, 4189610367, 4195303721, 4196515398,
	4212797959, 4214775363, 4224552008, 4225326421, 4225636490, 4225984492,
	4226039174, 4226149335, 4229787896, 4232141662, 4241723629, 4244715098,
	4246166293, 4253575489, 4254523221, 4258087266, 4262239130, 4266097211,
	4266581790, 4275356071, 4278493041, 4279380592, 4282739297, 4287468822,
	4294072380, 4294085066}
